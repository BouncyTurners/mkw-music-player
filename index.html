<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mario Kart World Music Player</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  #playlist { list-style: none; padding: 0; }
  #playlist li { margin: 5px 0; cursor: pointer; }
  #playlist li.playing { font-weight: bold; }
</style>
</head>
<body>

<h1>Mario Kart World Radio</h1>
<button id="shuffleBtn">Shuffle Playlist</button>
<ul id="playlist"></ul>
<div id="metadata">
  <p><strong>Title:</strong> <span id="title">-</span></p>
  <p><strong>Track Number:</strong> <span id="trackNumber">-</span></p>
  <p><strong>Composer:</strong> <span id="composer">-</span></p>
</div>
<audio id="audioPlayer" controls></audio>

<script>
const audioPlayer = document.getElementById('audioPlayer');
const playlistEl = document.getElementById('playlist');
const titleEl = document.getElementById('title');
const trackNumberEl = document.getElementById('trackNumber');
const composerEl = document.getElementById('composer');
const shuffleBtn = document.getElementById('shuffleBtn');

let tracks = [];
let currentTrack = 0;

// Shuffle functie
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// Playlist renderen
function renderPlaylist() {
  playlistEl.innerHTML = '';
  tracks.forEach((track, index) => {
    const li = document.createElement('li');
    li.textContent = track.title;
    li.addEventListener('click', () => playTrack(index));
    playlistEl.appendChild(li);
  });
}

// Track afspelen en metadata tonen
function playTrack(index) {
  currentTrack = index;
  const track = tracks[index];
  audioPlayer.src = track.url;
  audioPlayer.play();

  // Highlight playing track
  Array.from(playlistEl.children).forEach((li, i) => {
    li.classList.toggle('playing', i === index);
  });

  // Metadata tonen
  titleEl.textContent = track.title || '-';
  trackNumberEl.textContent = track.trackNumber || '-';
  composerEl.textContent = track.composer || '-';
}

// Shuffle knop
shuffleBtn.addEventListener('click', () => {
  shuffleArray(tracks);
  renderPlaylist();
});

// Autoplay next track
audioPlayer.addEventListener('ended', () => {
  currentTrack = (currentTrack + 1) % tracks.length;
  playTrack(currentTrack);
});

// Tracks laden vanuit JSON
fetch('./tracks.json')
  .then(res => res.json())
  .then(data => {
    tracks = data;
    renderPlaylist();
    if (tracks.length > 0) playTrack(0);
  })
  .catch(err => console.error('Error loading tracks.json:', err));
</script>

</body>
</html>